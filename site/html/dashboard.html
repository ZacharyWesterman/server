<div name="navbar"></div>
<div id="content" style="margin-left: 3rem;">
	<input id="file" type="file" name="file">
	<button onclick="upload_file()">Upload</button>

	<div name="blob_list"></div>
</div>

<script src="/js/date.js"></script>
<script src="/js/page/dashboard.js"></script>
<script>
window.upload_file = async function()
{
	var file = $('file').files[0]
	if (!file)
	{
		_.modal({
			title: '<span class="error">ERROR</span>',
			text: 'No file selected!',
			buttons: ['OK'],
		})
		return
	}

	await api.upload(file)
	reload_blobs()
}

async function get_blobs()
{
	return await api(`query ($start: Int!, $count: Int!){
		getAllBlobs(start: $start, count: $count) {
			id
			ext
			mimetype
			name
			creator
			created
		}
	}`, {
		start: 0,
		count: 20,
	})
}

window.reload_blobs = async function()
{
	var blobs = await get_blobs()
	for (var i in blobs)
	{
		blobs[i].created = date.output(blobs[i].created) //convert dates to local time
	}
	await _('blob_list', blobs)
}

reload_blobs()
</script>
