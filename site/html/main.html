<!DOCTYPE html>
<html lang="en">
<head>
	<title>test html</title>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<meta name="description" content="boilerplate html" />
</head>
<body>
	<p>
		<h1>Create New User</h1>
		<input id="username" placeholder="Username" />
		<input id="password" type="password" placeholder="Password" />
		<button type="button" onclick="create_user()">Submit</button>
	</p>
</body>
<script type="text/javascript">
	async function create_user()
	{
		const query = '\
		mutation ($username: String!, $password: String!){\
			createUser(username: $username, password: $password) {\
				__typename\
				...on BadUserNameError {\
					message\
				}\
			}\
		}'
		const vars = {
			'username' : document.all.username.value,
			'password' : btoa(await api.__hash(document.all.password.value)),
		}

		var res = await api.call(query, vars)
		res = res.data.createUser

		if (res.__typename !== 'UserData') {
			alert('ERROR: ' + res.message)
		}
	}

	async function list_users()
	{
		const query = '{ listUsers }'
		const res = await api.call(query)
		console.log(res.data.listUsers)
	}
</script>
</html>
