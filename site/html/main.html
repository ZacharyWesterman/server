<!DOCTYPE html>
<html lang="en">
<head>
	<title>test html</title>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<meta name="description" content="boilerplate html" />
</head>
<body>
	<h1>Hello World</h1>
	<button name="button" value="button-value" onclick="test()">Press Me</button>
</body>
<script type="text/javascript">
	function test()
	{
		var query = 'query ($username: String!) {\
			getUser(username:$username) {\
				username\
				name\
				age\
			}\
		}'
		var variables = {'username': 'peepo'}

		api(query, variables).then(response => {
			console.log(response)
		})
	}

	async function api(query_string, variables=null)
	{
		var query_data = {
			'query' : query_string,
			'variables': variables,
		}

		return new Promise(resolve => {
			api_request(query_data, resolve)
		})
	}

	function api_request(request_json, callback)
	{
		var url = '/api'
		var xhr = new XMLHttpRequest()
		xhr.open('POST', url, true)

		xhr.setRequestHeader('Content-Type', 'application/json')
		xhr.send(JSON.stringify(request_json))


		xhr.onreadystatechange = function()
		{
			if (this.readyState === XMLHttpRequest.DONE && typeof callback === 'function')
			{
				callback(JSON.parse(this.responseText))
			}
		}
	}
</script>
</html>
