<!DOCTYPE html>
<html lang="en">
<head>
	<title>Main Page</title>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description" content="Main Page" />

	<!-- <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js" defer></script> -->
	<!-- <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js" defer></script> -->
	<script src="https://kit.fontawesome.com/f78d847193.js" crossorigin="anonymous" async></script>
	<script type="module" src="/js/runtime_errors.js" async></script>
	<script type="text/javascript" src="/js/doT.js" async></script>
	<script type="module" src="/js/fields.js" async></script>
	<script type="text/javascript" src="/js/api.js" async></script>
	<script type="module" src="/js/navigate.js" async></script>

	<link rel="stylesheet" href="css/styles.css">
</head>
<body onload="auto_login()">
	<!-- for background css -->
	<div class="bg"></div>
	<div class="bg bg2"></div>
	<div class="bg bg3"></div>

	<!-- Checkmark display for special actions that don't need any extra information -->
	<svg id="action-checkmark" class="floating" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
		<circle cx="26" cy="26" r="25" fill="none"/>
		<path fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
	</svg>

	<!--placeholder for when modals are loaded in -->
	<div name="modal"></div>
	<div id="runtime-errors"></div>

	<div id="body">Loading...</div>

	<div id="loader" class="bottom left hidden"><i class="gg-spinner"></i></div>
</body>

<script defer>
	function auto_login()
	{
		//If required JS hasn't loaded yet, wait until it does.
		if (top.api === undefined || top._ === undefined || top.navigate === undefined)
		{
			setTimeout(auto_login, 50)
			return
		}

		api.read_cookies()
		//If not already logged in, go to login page
		if (api.login_token === null)
		{
			navigate('html/login.html')
		}
		else
		{
			api.verify_token().then(verified => {
				if (verified)
				{
					navigate('html/dashboard.html')
				}
				else
				{
					api.logout()
				}
			})
		}
	}
</script>
